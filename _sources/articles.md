# Статьи, книги, видео


## Хаос-инжиниринг помогает DevOps’ам справляться со сложностями.


Оригинал статьи: https://github.com/readme/featured/chaos-engineering  
Автор: Klint Finley  
Перевод: Роман Татевосян 



Телефон зазвонил, когда близился к концу последний час вашего on-call дежурства. Пользователи жалуются на то, что не могут отправлять сообщения, а это главная функция вашей платформы. Вы открываете программу и тут же видите проблему: кнопка «Отправить» не работает. Немного покопавшись, вы понимаете, что причиной проблемы является неисправность кэширующего сервера. Программа не может извлечь файл изображения с кнопкой, и на этом месте ничего не появляется. Вы перезапускаете кэширующий сервер. На следующий день, во время совещания по предотвращению инцидентов, frontend-команда добавляет запасную текстовую версию для всех элементов пользовательских интерфейсов на тот случай, если что-нибудь подобное повторится.

Проблемы с функционированием сервисов возникают все чаще и чаще, поскольку приложения развиваются и становятся сложнее. Продукты, которые выглядят для пользователей как нечто однообразное, в реальности представляют собой сложные комбинации различных элементов: серверов баз данных, API, микросервисов и библиотек – каждый из которых может выйти из строя в любой момент. Чтобы создать более устойчивые приложения и решить проблемы до того момента, когда они станут причиной сбоя, как это произошло в примере выше, DevOps-команды все чаще обращаются к дисциплине, которую называют «хаос-инжиниринг».

Самый простой пример: с помощью хаос-инжиниринга можно случайно выключить разные сервисы, чтобы посмотреть, как отреагирует система в целом. «Это помогает вам найти в системе ошибки, о существовании которых вы не знали», – говорит Нора Джонс, основательница и главный исполнительный директор стартапа [Jeli](https://www.jeli.io/) – компании, которая специализируется на анализе инцидентов. Кроме того, она является соавтором книги «Хаос-инжиниринг: устойчивость системы на практике» и бывшим инженером по обеспечению устойчивости в компании Netflix.


Например, в 2018, до запуска интерактивного фильма «Черное зеркало: Брандашмыг», команда Netflix обнаружила, что небольшое хранилище ключей-значений оказалось довольно важным, хотя они считали его некритичным. «Это было чем-то вроде скрытой зависимости», – говорит инженер по обеспечению устойчивости в Netflix Алеш Плшек. - «Эта находка позволила нам сфокусироваться на устранении уязвимости, о которой мы раньше не знали. Хаос-инжиниринг действительно помогает нам быть уверенными в том, что мы инвестируем ресурсы в правильном направлении».

Интерес к дисциплине хаос-инжиниринга возрос с тех пор, как Netflix опубликовал исходный код собственного инструмента проведения хаос-экспериментов.  Сегодня этот интерес связан с развитием таких проектов как [Litmus](https://litmuschaos.io/), [Chaos Toolkit](https://chaostoolkit.org/)  и [PowerfulSeal](https://powerfulseal.github.io/powerfulseal/), которые предоставляют надежные и кастомизируемые инструменты для проведения  хаос-экспериментов.

«Все организации, которые мне известны, сегодня в той или иной форме проводят  хаос-эксперименты со своими системами», – говорит Джон Оллспоу, основатель [Adaptive Capacity Labs](https://www.adaptivecapacitylabs.com/) и бывший технический директор Etsy. – «Хаос-эксперимент – одна из важнейших методик в области тестирования ИТ-продуктов. Методика хаос-эксперимента используется командами инженеров для повышения своей уверенности в работе сервиса в период создания программного обеспечения и, что даже важнее, при его модификации».

«Привлекательность хаос-инжиниринга заметна невооруженным глазом: во-первых, методика носит яркое название, а во-вторых, вам дают возможность крушить все подряд. Но хаос-инжиниринг – это не просто сеяние хаоса. Вы пытаетесь понять, как ваша система ведет себя», – говорит Сильван Эгуаш, ведущий разработчик проекта [Chaos Toolkit](https://chaostoolkit.org/) и сооснователь стартапа [Reliably](https://reliably.com/). – «Это научный метод. Вы выдвигаете гипотезу – обычно что-то в духе “Система продолжит работать в нормальном режиме, даже если потеряет доступ к одному экземпляру базы данных”, – а затем вы проверяете эту гипотезу и смотрите на результаты».

Самое главное – хаос-инжиниринг представляет особый тип инженерного мышления, который помогает DevOps-командам справляться с неопределенностью. Благодаря инструментам с открытым исходным кодом хаос-инжиниринг находит свое применение на всех стадиях жизненного цикла программного обеспечения и помогает разработчикам переосмыслить то, как они создают, тестируют и поддерживают программные продукты.

«Успешные организации не двигаются в сторону упрощения – они становятся только сложнее», – говорит Оллспоу. – «Все больше инженеров признают, что не могут самостоятельно спрогнозировать будущее поведение, а иногда даже и понять текущее состояние своей ИТ-инфраструктуры. Методика хаос-инжиниринга является в некотором смысле движущей силой, которая воздействует на образ мыслей ИТ-сообщества и адаптирует его к потребностям нового мира».


## Дисциплина хаоса

«Netflix начал работу над созданием хаос-инжиниринговой платформы в 2010 году, когда переводил свой сервис из физических дата-центров в облако», – поясняет Плшек. – «Они переживали за то, что может произойти в случае, если какой-либо инстанс AWS рухнет, или станут недоступны определенные сервисы. Экосистема наших ИТ сервисов меняется ежедневно, и в моменте по сути никто не знает, как это все устроено».

Netflix разработал сервис [Chaos Monkey](https://netflix.github.io/chaosmonkey/), исходя из простой идеи: отключать в произвольном порядке работу той или иной системы. «С началом применения хаос-экспериментов мы стали лучше осведомлены о потенциальных угрозах работы сервисов», – говорит Плшек.

Стриминговый сервис впервые рассказал о существовании [Chaos Monkey](https://netflix.github.io/chaosmonkey/) в своем блоге, вызвав большой резонанс в ИТ-сообществе. В то время многие компании также переносили свои сервисы в облако или, по крайней мере, уже использовали API удаленных сервисов и микросервисные архитектуры. «Помню, как читал этот пост много лет назад, еще до того, как я присоединился к Netflix, и он полностью изменил мое представление о том, как должны развиваться сервисы», – говорит Плшек. 

Впоследствии в 2012 году Netflix опубликовал исходный код [Chaos Monkey](https://netflix.github.io/chaosmonkey/). Это значительно облегчило работу других компаний по созданию собственных решений для хаос-экспериментов. «[Chaos Monkey](https://netflix.github.io/chaosmonkey/) сильно повлиял на будущие платформы хаос-тестирования», – говорит Эгуаш.

По мере распространения идеи хаос-инжиниринга open source сообщество разработало больше возможностей для адаптации [Chaos Monkey](https://netflix.github.io/chaosmonkey/) в разных организациях. «Мы пытались продать наш сервис по управлению данными большой компании, которая оказывала финансовые услуги», – поясняет Умасанкар Муккара, сооснователь [MayaData](https://mayadata.io/) и недавно созданной [Chaos Native](https://www.chaosnative.com/). – «Наши клиенты были уверены, что переход в облако пойдет им на пользу – например, ускорит предоставление услуг компании. Но они хотели, чтобы мы доказали надежность продукта.

Муккара и его команда пришли к мнению, что они могли бы использовать методику хаос-инжиниринга для тестирования собственной системы отказоустойчивости, и начали изучать возможные варианты. Они не хотели прибегать к проприетарному решению, а [Chaos Monkey](https://netflix.github.io/chaosmonkey/) не соответствовала их потребностям. «Мы хотели видеть такой продукт, который был бы разработан для работы с Kubernetes», – поясняет Муккара. – «Почти все новое ПО будет написано в облачной среде. Нам нужны такие инструменты, которые бы вписались в эту новую среду».

Таким образом, команда Муккары создала собственную хаос-инжиниринговую платформу, а ее исходный код разместила под названием Litmus. «Открытый исходный код – обычное явление в сегодняшнем мире», – поясняет Муккара. – «Экосистема Kubernetes базируется на свободном, открытом сотрудничестве, поэтому для нас было естественным поделиться нашими наработками с крупнейшими DevOps-сообществами». Об отклике пользователей на этот шаг Муккара говорит: «Реакция была суперпозитивной». 

На данный момент проект спонсируют более 100 человек: «Мы получаем обратную связь как от компаний, так и от людей, которые делятся с нами собственным видением того, как сделать сервис более эффективным и улучшить управление жизненным циклом системы».

В свою очередь Эгуаш и его команда подошли к вопросу разработки хаос-инжиниринговой платформы немного по-другому. Они не стали создавать такой инструмент, который был бы приспособлен исключительно к их собственной среде. Вместо этого команда Эгуаша разработала ядро кода, который мог быть использован компаниями из разных сфер, и предоставила им возможность доработать его под свои запросы.

«Мы начали пользоваться [Chaos Toolkit](https://chaostoolkit.org/) потому, что его можно кастомизировать», – говорит Рои Куперман, full-stack разработчик в хостинговой компании Wix. – «Это было легко – создавать отвечающие нашим потребностям плагины или расширять основной проект». Например, Wix внесла функции динамической конфигурации в основной проект [Chaos Toolkit](https://chaostoolkit.org/).

Именно открытое взаимодействие и возможность каждого внести свой вклад делает открытый исходный код таким важным для хаос-инжиниринга. «Любой человек может написать расширения, которые будут соответствовать конкретно их требованиям», – говорит Эгуаш. – «На самом деле невозможно, чтобы отдельно взятая компания или открытый исходный код проекта удовлетворили потребности всех и каждого. Я никогда не пользовался Azure, следовательно, не могу создать такой инструмент, который удовлетворял бы потребностям среды Azure. Но сообщество в целом такую способность имеет и может разработать инструменты для любой  ИТ-среды».


## Хаос повсюду

В сообществе существует четкое понимание того, что хаос-инжиниринг – это всего лишь часть чего-то более масштабного, и что инструменты хаос-инжиниринга не обязательно будут изолированными.  Исторически хаос-инжиниринг близок к процессу эксплуатации. Поэтому было бы уместно скоординировать работу по хаос-инжинирингу с функциями этой области, например, с функцией мониторинга.

Стартап [Jeli](https://www.jeli.io/) специализируется на анализе инцидентов – близкой к хаос-инжинирингу области, в которой изучаются и делаются выводы из сбоев ИТ систем. «Я думаю, что анализ инцидентов необходим для обеспечения успешной практики хаос-инжиниринга», – говорит Джонс. – «Вам нужно извлечь новую полезную информацию из хаос-экспериментов, и вам нужно создавать новые эксперименты на основе того, что вы поняли, исходя из анализа инцидентов. Сам анализ инцидентов может быть способом понять, какие аспекты работы системы наиболее важны для ваших клиентов, и что вам нужно тестировать еще больше. В моем представлении хаос-инжиниринг и анализ инцидентов идут рука об руку».

Между тем, как и в случае с безопасностью, хаос-инжиниринг смещается влево, к первой половине термина DevOps. «Главное, что мы видим – это внедрение культуры хаоса во всю компанию», – говорит Эгуаш. – «Я ожидаю, что мы увидим такие инструменты хаос-инжиниринга, которые будут поддерживать множество ролей на всем релизном цикле, включая мониторинг и анализ инцидентов, разработку и QA. Сдвиги уже происходят».

В компании Wix хаос-инжиниринг исторически был частью процесса эксплуатации и тесно связан с инструментами мониторинга и оповещения, но он также распространяется и на прикладной уровень. «Я думаю, что хаос-инжиниринг всегда будет основополагающей частью процесса эксплуатации, но в ближайшем будущем он также станет частью процесса CI/CD у тех команд разработчиков, которые заняты созданием инфраструктуры», – говорит Куперман. Компания Harness, которая специализируется на CI/CD, недавно приобрела платформу [Chaos Native](https://www.chaosnative.com/). Данная сделка подтверждает, что хаос-инжиниринг развивается в направлении сближения с CI/CD.

Открытый исходный код продолжит расширять экспансию хаос-инжиниринга и, что важнее, хаос-мышления в организациях. Каждый из этих проектов предлагает не просто инструменты для проведения хаос-экспериментов, но и определенную инструкцию к тому, как использовать эту дисциплину. «ИТ-индустрии нужно учиться решать серьезные проблемы коллективно. Такими важными проблемами являются безопасность и надежность, с ними сталкиваются все», – говорит Эгуаш. – «Открытый исходный код предоставляет ИТ-сообществу уникальную возможность совместного решения этих проблем».


Вопросы для обсуждения:
- Являются ли инструменты для хаос-испытаний проприетарными или открытыми?

- Как измерить результаты от проведения хаос-испытаний?

- Для каких систем хаос-испытания могут принести наибольшие результаты?

- Что, на ваш взгляд, ограничивает применение хаос-испытаний в организациях и отдельных командах?

- Найдите в тексте формулировку гипотезы хаос-испытаний. Как ее можно улучшить? Как можно проверить такую гипотезу? Что будет результатом проверки?